import streamlit as st
import pandas as pd
import joblib
import matplotlib.pyplot as plt
import seaborn as sns
import xgboost


# Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î¼Î¿Î½Ï„Î­Î»Î¿Ï… ÎºÎ±Î¹ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
model = joblib.load("xgboost_model.pkl")
df = pd.read_csv("distal_radius_fracture_recovery.csv")

# ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ features Ï€Î¿Ï… Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹ Ï„Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿
model_features = [
    "age", "sex", "dominant_hand_injured", "osteoporosis", "charlson_index",
    "edmonton_frail_scale", "pase_score", "risk_triad", "social_support",
    "fracture_type", "displacement", "fracture_stability", "operative_treatment",
    "immobilization_days"
]




with st.sidebar.expander("â“ Î£Ï…Ï‡Î½Î­Ï‚ Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ / Î’Î¿Î®Î¸ÎµÎ¹Î±"):
    st.markdown("""
- **Charlson Comorbidity Index (CCI):**
    - ÎŸ CCI ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Î´Î¹ÎµÎ¸Î½ÏÏ‚ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î¯Î¼Î·ÏƒÎ· Ï„Î·Ï‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ®Ï‚ Î²Î±ÏÏÏ„Î·Ï„Î±Ï‚ Ï„Ï‰Î½ Ï€Î±ÏÎ±Î»Î»Î·Î»Ï‰Î½ Ï€Î±Î¸Î·ÏƒÎµÏ‰Î½ ÎµÎ½ÏŒÏ‚ Î±ÏƒÎ¸ÎµÎ½Î¿ÏÏ‚.
    - ÎšÎ¬Î¸Îµ Ï‡ÏÏŒÎ½Î¹Î± Ï€Î¬Î¸Î·ÏƒÎ· (Ï€.Ï‡. Î´Î¹Î±Î²Î®Ï„Î·Ï‚, ÎºÎ±ÏÎ´Î¹Î±ÎºÎ® Î±Î½ÎµÏ€Î¬ÏÎºÎµÎ¹Î±, ÎºÎ±ÏÎºÎ¯Î½Î¿Ï‚, Î·Ï€Î±Ï„Î¹ÎºÎ® Î½ÏŒÏƒÎ¿Ï‚, Î§Î‘Î , Î¬Î½Î¿Î¹Î±, Îº.Î¬.) Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï…Ï‚ Î²Î±Î¸Î¼Î¿ÏÏ‚ ÏƒÏ„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ ÏƒÎºÎ¿Ï, Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î· Î²Î±ÏÏÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Ï‰Î½ ÏƒÏ…Î½Î¿ÏƒÎ·ÏÎ¿Ï„Î®Ï„Ï‰Î½.
    - ÎŒÏƒÎ¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ Ï„Î¿ ÏƒÎºÎ¿Ï, Ï„ÏŒÏƒÎ¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿Ï‚ Î¿ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Î³Î¹Î± ÎµÏ€Î¹Ï€Î»Î¿ÎºÎ­Ï‚, ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î±Î½Î¬ÏÏÏ‰ÏƒÎ· ÎºÎ±Î¹ Î¸Î½Î·Ï„ÏŒÏ„Î·Ï„Î±.
    - Î¤Î¹Î¼Î­Ï‚ CCI: 0 (Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏ…Î½Î¿ÏƒÎ·ÏÏŒÏ„Î·Ï„ÎµÏ‚) Î­Ï‰Ï‚ 10+ (Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ Î® ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÏƒÏ…Î½Î¿ÏƒÎ·ÏÏŒÏ„Î·Ï„ÎµÏ‚).
    - Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎµÏ…ÏÎ­Ï‰Ï‚ Î³Î¹Î± Ï„Î·Î½ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· Ï„Î·Ï‚ Ï€ÏÏŒÎ³Î½Ï‰ÏƒÎ·Ï‚ ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î¹Î±Ï„ÏÎ¹ÎºÎ­Ï‚ ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.
    - [Charlson ME, et al. J Chronic Dis. 1987](https://pubmed.ncbi.nlm.nih.gov/3558716/)

- **Edmonton Frail Scale:**
    - ÎšÎ»Î¯Î¼Î±ÎºÎ± ÎµÏ…Ï€Î±Î¸ÎµÎ¹Î±Ï‚ (0-17) Ï€Î¿Ï… Î±Î¾Î¹Î¿Î»Î¿Î³ÎµÎ¯ Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ (Î³Î½Ï‰ÏƒÏ„Î¹ÎºÎ® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±, Î³ÎµÎ½Î¹ÎºÎ® Ï…Î³ÎµÎ¯Î±, Î±Î½ÎµÎ¾Î±ÏÏ„Î·ÏƒÎ¯Î±, ÎºÎ¿Î¹Î½Ï‰Î½Î¹ÎºÎ® Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·, Î´Î¹Î±Ï„ÏÎ¿Ï†Î®, Ï†Î±ÏÎ¼Î±ÎºÎµÏ…Ï„Î¹ÎºÎ® Î±Î³Ï‰Î³Î®, Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î±/Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±).
    - Î¥ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ· Ï„Î¹Î¼Î® ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· ÎµÏ…Î±Î»Ï‰Ï„ÏŒÏ„Î·Ï„Î±/ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÎºÎ±Î¹ Î±Ï…Î¾Î·Î¼Î­Î½Î¿ ÎºÎ¯Î½Î´Ï…Î½Î¿ Î³Î¹Î± ÎµÏ€Î¹Ï€Î»Î¿ÎºÎ­Ï‚, Ï€Ï„ÏÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Î´Ï…ÏƒÎ¼ÎµÎ½Î® Î­ÎºÎ²Î±ÏƒÎ·.
    - Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎºÏ…ÏÎ¯Ï‰Ï‚ ÏƒÎµ Î·Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î¯Î¼Î·ÏƒÎ· Ï„Î·Ï‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ®Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Ï…Î³ÎµÎ¯Î±Ï‚.
    - [Rolfson DB, et al. Age Ageing. 2006](https://pubmed.ncbi.nlm.nih.gov/16641176/)

- **PASE Score:**
    - Physical Activity Scale for the Elderly (0-400). ÎšÎ»Î¯Î¼Î±ÎºÎ± Ï€Î¿Ï… Î¼ÎµÏ„ÏÎ¬ Ï„Î· Ï†Ï…ÏƒÎ¹ÎºÎ® Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÏƒÎµ Î·Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Ï…Ï‚, Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Ï‚ Ï…Ï€ÏŒÏˆÎ· ÎµÏÎ³Î±ÏƒÎ¯Î±, Î¬ÏƒÎºÎ·ÏƒÎ· ÎºÎ±Î¹ ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î­Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚.
    - Î¥ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ· Ï„Î¹Î¼Î® ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ· Ï†Ï…ÏƒÎ¹ÎºÎ® Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ ÎºÎ±Î»ÏÏ„ÎµÏÎ· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±.
    - Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Î±Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· Ï„Î·Ï‚ Ï†Ï…ÏƒÎ¹ÎºÎ®Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· Ï„Î·Ï‚ Î±Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚.
    - [Washburn RA, et al. J Clin Epidemiol. 1993](https://pubmed.ncbi.nlm.nih.gov/8410095/)

- **Displacement:**
    - ÎœÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ· ÎºÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚ (0 = ÏŒÏ‡Î¹, 1 = Î½Î±Î¹). Î— Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Î¼ÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ·Ï‚ ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î²Î±ÏÏÏ„Î·Ï„Î± ÎºÎ¬ÎºÏ‰ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÏƒÏ…Ï‡Î½Î¬ Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï€Î¹Î¿ ÎµÏ€Î¹Î¸ÎµÏ„Î¹ÎºÎ® Î¸ÎµÏÎ±Ï€ÎµÎ¯Î±.
    - [MÃ¼ller ME, et al. AO classification of fractures. Injury. 1990](https://pubmed.ncbi.nlm.nih.gov/2221851/)

- **DASH Score:**
    - Î•ÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»ÏŒÎ³Î¹Î¿ DASH (Disabilities of the Arm, Shoulder and Hand) ÏƒÏ„Î¿Ï…Ï‚ 6 Î¼Î®Î½ÎµÏ‚ (0-100, Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ = Ï‡ÎµÎ¹ÏÏŒÏ„ÎµÏÎ· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±).
    - Î‘Î¾Î¹Î¿Î»Î¿Î³ÎµÎ¯ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… Î¬Î½Ï‰ Î¬ÎºÏÎ¿Ï… Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Ï„ÏÎ±Ï…Î¼Î±Ï„Î¹ÏƒÎ¼Î¿ÏÏ‚ Î® Ï€Î±Î¸Î®ÏƒÎµÎ¹Ï‚.
    - [Hudak PL, et al. The DASH outcome measure. Am J Ind Med. 1996](https://pubmed.ncbi.nlm.nih.gov/8773720/)

- **Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Î”ÏÎ½Î±Î¼Î·Ï‚ Î›Î±Î²Î®Ï‚:**  
Î Î¿ÏƒÎ¿ÏƒÏ„Î¹Î±Î¯Î± Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Ï„Î·Ï‚ Î´ÏÎ½Î±Î¼Î·Ï‚ Î»Î±Î²Î®Ï‚ (%) Î¼ÎµÏ„Î¬ Ï„Î· Î¸ÎµÏÎ±Ï€ÎµÎ¯Î± ÏƒÎµ ÏƒÏ‡Î­ÏƒÎ· Î¼Îµ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î¼Î­Ï„ÏÎ·ÏƒÎ·.

- **ROM (Range of Motion):**
    - Î•ÏÏÎ¿Ï‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚ ÎºÎ±ÏÏ€Î¿Ï ÏƒÏ„Î¿Ï…Ï‚ 3 Î¼Î®Î½ÎµÏ‚ (Î¼Î¿Î¯ÏÎµÏ‚). Î‘Î¾Î¹Î¿Î»Î¿Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ Ï„Î­ÏƒÏƒÎµÏÎ¹Ï‚ Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚:
        - **rom_extension_3m:** ÎˆÎºÏ„Î±ÏƒÎ· (extension)
        - **rom_flexion_3m:** ÎšÎ¬Î¼ÏˆÎ· (flexion)
        - **rom_supination_3m:** Î¥Ï€Ï„Î¹Î±ÏƒÎ¼ÏŒÏ‚ (supination)
        - **rom_pronation_3m:** Î ÏÎ·Î½Î¹ÏƒÎ¼ÏŒÏ‚ (pronation)
    - Î— Î±Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… ROM ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î· Î³Î¹Î± Ï„Î·Î½ ÎµÏ€Î¬Î½Î¿Î´Î¿ ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±.
    - [MacDermid JC, et al. Measurement of wrist motion. J Hand Ther. 2001](https://pubmed.ncbi.nlm.nih.gov/11511019/)

- **Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± ÎšÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚:**  
Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± ÎºÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚ (Î£Ï„Î±Î¸ÎµÏÏŒ/Î‘ÏƒÏ„Î±Î¸Î­Ï‚). Î— ÏƒÏ„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î· Î¸ÎµÏÎ±Ï€ÎµÏ…Ï„Î¹ÎºÎ® Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÏŒÎ³Î½Ï‰ÏƒÎ·.
    """)

# Mapping dictionaries Î³Î¹Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÎºÎ¬
sex_map = {"Î‘Î½Î´ÏÎ±Ï‚": 0, "Î“Ï…Î½Î±Î¯ÎºÎ±": 1}
dominant_hand_injured_map = {"ÎŒÏ‡Î¹": 0, "ÎÎ±Î¹": 1}
osteoporosis_map = {"ÎŒÏ‡Î¹": 0, "ÎÎ±Î¹": 1}
risk_triad_map = {"ÎŒÏ‡Î¹": 0, "ÎÎ±Î¹": 1}
social_support_map = {"ÎšÎ±Î¼Î¯Î±": 0, "ÎœÎµÏÎ¹ÎºÎ®": 1, "Î£Ï„Î±Î¸ÎµÏÎ®": 2}
fracture_type_map = {"Î•Î¾Ï‰Î±ÏÎ¸ÏÎ¹ÎºÏŒ": 0, "Î•Î½Î´Î¿Î±ÏÎ¸ÏÎ¹ÎºÏŒ": 1}
displacement_map = {"ÎŒÏ‡Î¹": 0, "ÎÎ±Î¹": 1}
fracture_stability_map = {"Î£Ï„Î±Î¸ÎµÏÏŒ": 0, "Î‘ÏƒÏ„Î±Î¸Î­Ï‚": 1}
operative_treatment_map = {"ÎŒÏ‡Î¹": 0, "ÎÎ±Î¹": 1}

st.title("Î•ÎºÏ„Î¯Î¼Î·ÏƒÎ· Î§ÏÏŒÎ½Î¿Ï… Î‘Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ ÎœÎµÏ„Î¬ Î‘Ï€ÏŒ ÎšÎ¬Ï„Î±Î³Î¼Î± ÎšÎµÏÎºÎ¯Î´Î±Ï‚")

# Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Ï„Î¹Î¼ÏÎ½ Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·
age = st.number_input("Î—Î»Î¹ÎºÎ¯Î±", min_value=18, max_value=100, value=60)
sex = st.selectbox("Î¦ÏÎ»Î¿", ["Î‘Î½Î´ÏÎ±Ï‚", "Î“Ï…Î½Î±Î¯ÎºÎ±"])
dominant_hand_injured = st.selectbox("Î¤ÏÎ±Ï…Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏ…ÏÎ¯Î±ÏÏ‡Î¿Ï… Î¬Î½Ï‰ Î¬ÎºÏÎ¿Ï…;", ["ÎŒÏ‡Î¹", "ÎÎ±Î¹"])
osteoporosis = st.selectbox("ÎŸÏƒÏ„ÎµÎ¿Ï€ÏŒÏÏ‰ÏƒÎ·", ["ÎŒÏ‡Î¹", "ÎÎ±Î¹"])
charlson_index = st.number_input("Charlson Comorbidity Index", min_value=0, max_value=10, value=2)
edmonton_frail_scale = st.number_input("Edmonton Frail Scale", min_value=0, max_value=17, value=5)
pase_score = st.number_input("PASE Score", min_value=0, max_value=400, value=100)
social_support = st.selectbox("ÎšÎ¿Î¹Î½Ï‰Î½Î¹ÎºÎ®/ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÎ® Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·", ["ÎšÎ±Î¼Î¯Î±", "ÎœÎµÏÎ¹ÎºÎ®", "Î£Ï„Î±Î¸ÎµÏÎ®"])
fracture_type = st.selectbox("Î¤ÏÏ€Î¿Ï‚ ÎšÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚", ["Î•Î¾Ï‰Î±ÏÎ¸ÏÎ¹ÎºÏŒ", "Î•Î½Î´Î¿Î±ÏÎ¸ÏÎ¹ÎºÏŒ"])
displacement = st.selectbox("Î Î±ÏÎµÎºÏ„ÏŒÏ€Î¹ÏƒÎ·", ["ÎŒÏ‡Î¹", "ÎÎ±Î¹"])
fracture_stability = st.selectbox("Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± ÎšÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚", ["Î£Ï„Î±Î¸ÎµÏÏŒ", "Î‘ÏƒÏ„Î±Î¸Î­Ï‚"])
operative_treatment = st.selectbox("Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³Î¹ÎºÎ® Î‘Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ·", ["ÎŒÏ‡Î¹", "ÎÎ±Î¹"])
immobilization_days = st.number_input("Î”Î¹Î¬ÏÎºÎµÎ¹Î± Î‘ÎºÎ¹Î½Î·Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ (Î·Î¼Î­ÏÎµÏ‚)", min_value=10, max_value=60, value=30)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ risk_triad Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±:
risk_triad = 1 if (sex == "Î“Ï…Î½Î±Î¯ÎºÎ±" and age > 65 and osteoporosis == "ÎÎ±Î¹") else 0

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± input DataFrame Î¼Îµ mapping
input_dict = {
    "age": age,
    "sex": sex_map[sex],
    "dominant_hand_injured": dominant_hand_injured_map[dominant_hand_injured],
    "osteoporosis": osteoporosis_map[osteoporosis],
    "charlson_index": charlson_index,
    "edmonton_frail_scale": edmonton_frail_scale,
    "pase_score": pase_score,
    "risk_triad": risk_triad_map[risk_triad],
    "social_support": social_support_map[social_support],
    "fracture_type": fracture_type_map[fracture_type],
    "displacement": displacement_map[displacement],
    "fracture_stability": fracture_stability_map[fracture_stability],
    "operative_treatment": operative_treatment_map[operative_treatment],
    "immobilization_days": immobilization_days,
}
input_df = pd.DataFrame([input_dict])

# ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± NaN Î¼ÎµÏ„Î¬ Ï„Î¿ mapping
if input_df[model_features].isnull().any().any():
    st.error("ÎšÎ¬Ï€Î¿Î¹Î± Ï€ÎµÎ´Î¯Î± Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÏƒÏ‰ÏƒÏ„Î® Ï„Î¹Î¼Î®. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÎºÎ¬ Ï€ÎµÎ´Î¯Î±.")
    st.stop()

# Î¤ÎµÎ»Î¹ÎºÎ® ÏƒÎµÎ¹ÏÎ¬ ÏƒÏ„Î·Î»ÏÎ½
input_df = input_df[model_features]

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Risk Score Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î· ÏƒÎ·Î¼Î±ÏƒÎ¯Î± Ï„Ï‰Î½ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏÎ½
risk_score = (
    osteoporosis_map[osteoporosis] * 0.20 +
    risk_triad_map[risk_triad] * 0.15 +
    charlson_index * 0.12 +
    fracture_stability_map[fracture_stability] * 0.10 +
    age / 100 * 0.07 +
    operative_treatment_map[operative_treatment] * 0.05 +
    fracture_type_map[fracture_type] * 0.03 +
    displacement_map[displacement] * 0.03 +
    edmonton_frail_scale / 17 * 0.02 +
    pase_score / 400 * -0.02 +  # Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒ Î²Î¬ÏÎ¿Ï‚: Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ PASE = Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿Ï‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚
    social_support_map[social_support] * -0.02  # Î‘ÏÎ½Î·Ï„Î¹ÎºÏŒ Î²Î¬ÏÎ¿Ï‚: ÎºÎ±Î»ÏÏ„ÎµÏÎ· Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· = Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿Ï‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚
)

st.metric("Risk Score", f"{risk_score:.2f}")

# ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ· Risk Score
if risk_score < 0.25:
    risk_level = "ğŸŸ¢ Î§Î±Î¼Î·Î»ÏŒÏ‚ ÎšÎ¯Î½Î´Ï…Î½Î¿Ï‚"
    risk_color = "green"
elif risk_score < 0.45:
    risk_level = "ğŸŸ¡ ÎœÎ­Ï„ÏÎ¹Î¿Ï‚ ÎšÎ¯Î½Î´Ï…Î½Î¿Ï‚"
    risk_color = "orange"
else:
    risk_level = "ğŸ”´ Î¥ÏˆÎ·Î»ÏŒÏ‚ ÎšÎ¯Î½Î´Ï…Î½Î¿Ï‚"
    risk_color = "red"

st.markdown(
    f"<span style='color:{risk_color}; font-weight:bold; font-size:1.2em;'>Î•ÎºÏ„Î¯Î¼Î·ÏƒÎ·: {risk_level}</span>",
    unsafe_allow_html=True
)

with st.sidebar.expander("â„¹ï¸ Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Risk Score;"):
    st.markdown("""
**Risk Score**: ÎˆÎ½Î±Ï‚ ÏƒÏÎ½Î¸ÎµÏ„Î¿Ï‚ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Ï€Î¿Ï… ÏƒÏ…Î½Î´Ï…Î¬Î¶ÎµÎ¹ Ï„Î± ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒÏ„ÎµÏÎ± ÎºÎ»Î¹Î½Î¹ÎºÎ¬ ÎºÎ±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¬ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ (Î¿ÏƒÏ„ÎµÎ¿Ï€ÏŒÏÏ‰ÏƒÎ·, risk triad, Ï€Î±ÏÎ±Î»Î»Î·Î»ÎµÏ‚ Ï€Î±Î¸Î·ÏƒÎµÎ¹Ï‚, Ï€ÏÏÎ¹Î¼Î· Ï†Ï…ÏƒÎ¹ÎºÎ¿Î¸ÎµÏÎ±Ï€ÎµÎ¯Î±, ÏƒÏ„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± ÎºÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚, Î´Î¹Î±Î²Î®Ï„Î·Ï‚, Î·Î»Î¹ÎºÎ¯Î±, Ï„ÏÏ€Î¿Ï‚ Î¸ÎµÏÎ±Ï€ÎµÎ¯Î±Ï‚, Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¹ÏÎ½, Ï„ÏÏ€Î¿Ï‚ ÎºÎ±Ï„Î¬Î³Î¼Î±Ï„Î¿Ï‚, Î¼ÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ·, ÎµÏ…Ï€Î±Î¸ÎµÎ¹Î±, Ï†Ï…ÏƒÎ¹ÎºÎ® Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±, Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±, Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Î´ÏÎ½Î±Î¼Î·Ï‚).
ÎŒÏƒÎ¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿Ï‚ Î¿ Î´ÎµÎ¯ÎºÏ„Î·Ï‚, Ï„ÏŒÏƒÎ¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î· Ï€ÏÎ¿Î²Î»ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î´Ï…ÏƒÎºÎ¿Î»Î¯Î± Î±Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚.
ÎŸ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Î±Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î´ÎµÎ¹ÎºÏ„Î¹ÎºÏŒÏ‚ ÎºÎ±Î¹ Î´ÎµÎ½ Î±Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î·Î½ Î¹Î±Ï„ÏÎ¹ÎºÎ® ÎºÏÎ¯ÏƒÎ·.
    """)

if st.button("ğŸ”® Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î§ÏÏŒÎ½Î¿Ï… Î‘Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚"):
    prediction_weeks = model.predict(input_df)[0]
    st.subheader(f"ğŸ•’ Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î¿Ï‚ Î§ÏÏŒÎ½Î¿Ï‚ Î‘Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚: **{prediction_weeks:.1f} ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚**")
    st.info("âš ï¸ Î‘Ï…Ï„Î® Î· Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÏŒ Î¼Î¿Î½Ï„Î­Î»Î¿ Î¼Îµ Ï„ÎµÏ‡Î½Î·Ï„Î¬ (ÏƒÏ…Î½Î¸ÎµÏ„Î¹ÎºÎ¬) Î´ÎµÎ´Î¿Î¼Î­Î½Î±. âš ï¸")

    avg_weeks = df["recovery_time_weeks"].mean()
    st.markdown(f"ğŸ“Š **ÎœÎ­ÏƒÎ¿Ï‚ Ï‡ÏÏŒÎ½Î¿Ï‚ Î±Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ Î´ÎµÎ¯Î³Î¼Î±:** `{avg_weeks:.1f} ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚`")

    fig, ax = plt.subplots()
    sns.histplot(df["recovery_time_weeks"], kde=True, bins=20, ax=ax, color='skyblue')
    ax.axvline(prediction_weeks, color='red', linestyle='--', label='Î— Ï€ÏÏŒÎ²Î»ÎµÏˆÎ® ÏƒÎ±Ï‚')
    ax.axvline(avg_weeks, color='green', linestyle='--', label='ÎœÎ­ÏƒÎ¿Ï‚ ÏŒÏÎ¿Ï‚')
    ax.legend()
    st.pyplot(fig)







